<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sinusoidal Embeddings &#8212; neuraloperator 1.0.2 documentation</title> 
<link rel="stylesheet" href="../../_static/tensorly_style.css">
<link rel="apple-touch-icon" sizes="180x180" href="../../_static/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../_static/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../_static/favicon/favicon-16x16.png">
<link rel="manifest" href="../../_static/favicon/site.webmanifest">
<link rel="mask-icon" href="../../_static/favicon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../../_static/favicon/favicon.ico">
<meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/tensorly_style.css?v=a02e9698" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <script src="../../_static/documentation_options.js?v=1ed6394b"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
 <script src="../../_static/navbar_burger.js"></script>
 <script defer src="https://use.fontawesome.com/releases/v5.14.0/js/all.js"></script>
 
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fourier Continuation" href="plot_fourier_continuation.html" />
    <link rel="prev" title="Fourier Differentiation" href="plot_fourier_diff.html" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  </head>
<body  class="has-navbar-fixed-top">

  <header>
    <navbar>
      <nav class="navbar top-navbar is-fixed-top has-shadow is-flex-wrap-wrap" role="navigation" aria-label="main top navigation">
        <div class="navbar-brand">
        

          <a class="navbar-item" href="../../index.html">
            <img src="../../_static/neuraloperator_logo.png" height="28">
          </a>
          <a class="navbar-item is-hidden-desktop" href="https://github.com/neuraloperator/neuraloperator" target="_blank">
              <span class="icon"><i class="fab fa-github"></i></span>
          </a>

          <a role="button" class="navbar-burger" data-target="top-nav-menu" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>

        </div>
        
        <div class="navbar-menu" id="top-nav-menu">
        

          <div class="navbar-start">
            
              <a class="navbar-item" href="../../install.html">
              Install
            </a>
              <a class="navbar-item" href="../../theory_guide/index.html">
              Theory Guide
            </a>
              <a class="navbar-item" href="../../user_guide/index.html">
              User Guide
            </a>
              <a class="navbar-item" href="../../modules/api.html">
              API
            </a>
              <a class="navbar-item" href="../index.html">
              Examples
            </a>
              <a class="navbar-item" href="../../dev_guide/index.html">
              Developer's Guide
            </a>
          </div>
        
          <div class="navbar-end">
            <div class="navbar-item">
            
            <a class="button is-hidden-touch is-dark" href="https://github.com/neuraloperator/neuraloperator" target="_blank">
              <span class="icon-text">
                <span class="icon is-large">
                  <i class="fab fa-github"></i>
                </span>
                <span>Github</span>
              </span>
            </a>

            </div> 
          </div> 
        </div> 

      </nav>
      
    </navbar>
  </header>


  <div id="column-container">
  <div class="columns is-mobile is-centered">
	
  
      <div class="column is-10-mobile is-one-third-tablet is-3-desktop is-hidden-mobile" id="sidebar">
    
    <aside class="sticky-nav sidebar-menu">
<div class="sidebar-search">
  <form class="field" id="searchbox" role="search" action="../../search.html" method="get">
    <!-- <label class="label" id="searchlabel">Quick search</label> -->
    <div class="field has-addons">
      <div class="control is-expanded">
        <input class="input" type="text" placeholder="Search the doc" name="q" aria-labelledby="searchlabel autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      </div>
      <div class="control">
        <input class="button is-info" type="submit" value="Go" />
      </div>
    </div>
  </form>
  <script>document.getElementById('searchbox').style.display = "block"</script>

</div>
      
      <div class="sidebar-menu-toc">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installing NeuralOperator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory_guide/index.html">Theory Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/api.html">API reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#data">Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#data-generation">Data Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#layers">Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#models">Models</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#training-and-meta-algorithms">Training and Meta-Algorithms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Development guide</a></li>
</ul>
 
      </div>
    </aside>
  </div>
  

  <div class="column main-column">

    
    <div class="main-section">

      
      
      <div class="side-menu-toggle">
        <button class="button" id="toggle-sidebar" onclick="toggle_sidebar()">
          <span class="icon"><i class="fa fa-bars" aria-hidden="true"></i></span>
          <span>menu</span> 
        </button>
      </div>
      

      <div class="container content main-content">
        
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-layers-plot-sinusoidal-embeddings-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="sinusoidal-embeddings">
<span id="sphx-glr-auto-examples-layers-plot-sinusoidal-embeddings-py"></span><h1>Sinusoidal Embeddings<a class="headerlink" href="#sinusoidal-embeddings" title="Link to this heading"></a></h1>
<p>Inputs to deep learning models often represent positions on a spatial, temporal, or
spatio-temporal grid. To enrich these coordinates, positional embeddings can be introduced
to improve a model’s capacity to generalize across the domain. In this tutorial, we focus
on sinusoidal positional embeddings.</p>
<p>Sinusoidal embeddings encode inputs as periodic functions (sines and cosines), thereby
lifting low-dimensional coordinates into a richer spectral representation. This spectral
lifting enhances the model’s ability to capture fine-scale variations and high-frequency
dynamics.</p>
<div style="margin-top: 3em;"></div><section id="setup-in-1d">
<h2>Setup in 1D<a class="headerlink" href="#setup-in-1d" title="Link to this heading"></a></h2>
<p>To build intuition, consider a simple 1D example. Let <span class="math notranslate nohighlight">\(x \in \mathbb{R}\)</span>
be a single input, and define the embedding function</p>
<div class="math notranslate nohighlight">
\[g: \mathbb{R} \rightarrow \mathbb{R}^{2 L}, \quad g(x)=[\sin (x), \  \cos (x), \ \sin (2 x), \ \cos (2 x), \ldots, \ \sin (L x), \ \cos (L x)],\]</div>
<p>where <span class="math notranslate nohighlight">\(L\)</span> defines the number of frequencies we wish to use for the embedding. Each
pair of sine and cosine terms introduces a higher frequency, enriching how positional
information is represented.</p>
<p>This idea naturally extends to an entire 1D input. Let <span class="math notranslate nohighlight">\(\vec{x} \in \mathbb{R}^N\)</span>
denote a discretized domain of <span class="math notranslate nohighlight">\(N\)</span> points. Then the embedding function becomes</p>
<div class="math notranslate nohighlight">
\[g: \mathbb{R}^N \rightarrow \mathbb{R}^{N \times 2 L}, \quad g(\vec{x})=\operatorname{concat}(\sin (\vec{x}), \cos (\vec{x}), \sin (2 \vec{x}), \cos (2 \vec{x}), \ldots, \sin (L \vec{x}), \cos (L \vec{x})),\]</div>
<p>In practice, both the original coordinate and its embedding are passed to the model:</p>
<div class="math notranslate nohighlight">
\[\operatorname{input}(\vec{x})=\operatorname{concat}(\vec{x}, \ g(\vec{x})) \in \mathbb{R}^{N \times 2 L + 1},\]</div>
<p>preserving the original input, while augmenting it with a hierarchy of frequency components.</p>
<div style="margin-top: 2em;"></div><section id="domain-normalization">
<h3>Domain Normalization<a class="headerlink" href="#domain-normalization" title="Link to this heading"></a></h3>
<p>When applying sinusoidal embeddings, it is often useful to normalize the input coordinates
to a periodic interval that aligns with the natural period of the sine and cosine functions.
For example, a 1D spatial domain <span class="math notranslate nohighlight">\(\vec{x} \in[0,1]\)</span> of <span class="math notranslate nohighlight">\(N\)</span> points can be rescaled to</p>
<div class="math notranslate nohighlight">
\[\vec{x}^{\prime}=2 \pi \vec{x},\]</div>
<p>so that <span class="math notranslate nohighlight">\(\vec{x}^{\prime} \in[0,2 \pi]\)</span>.</p>
<p>This mapping preserves the number of sampling points <span class="math notranslate nohighlight">\(N\)</span> and the overall shape of the domain
while ensuring that the lowest-frequency sine and cosine components complete exactly one
full oscillation over the interval.</p>
<div style="margin-top: 2em;"></div></section>
<section id="choosing-l-to-satisfy-the-nyquist-criterion">
<h3>Choosing <span class="math notranslate nohighlight">\(L\)</span> to Satisfy the Nyquist-Criterion<a class="headerlink" href="#choosing-l-to-satisfy-the-nyquist-criterion" title="Link to this heading"></a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When choosing the number of frequency levels <span class="math notranslate nohighlight">\(L\)</span>, it is important to ensure that the
highest frequency component in the embedding does not exceed the Nyquist limit imposed by
the discretisation of the input domain.</p>
</div>
<p>For a domain of <span class="math notranslate nohighlight">\(N\)</span> points, the Nyquist frequency is</p>
<div class="math notranslate nohighlight">
\[f_{\text{Nyquist}} = \frac{N}{2}.\]</div>
<p>For the sinusoidal embedding defined above, the Nyquist constraint becomes:</p>
<div class="math notranslate nohighlight">
\[L &lt; \frac{N}{2}.\]</div>
<p>The Nyquist frequency represents the maximum frequency that can be correctly captured
when sampling a signal, equal to half the sampling rate. If frequencies higher than this
limit are used, they will not be represented as true high frequencies but will instead appear
as lower ones, producing distortion known as aliasing. This is why we must ensure that
the highest frequency in our embedding does not exceed the Nyquist limit.</p>
<div style="margin-top: 2em;"></div></section>
<section id="visualizing-the-sinusoidal-embeddings">
<h3>Visualizing the Sinusoidal Embeddings<a class="headerlink" href="#visualizing-the-sinusoidal-embeddings" title="Link to this heading"></a></h3>
<p>Below, we visualize the sinusoidal embeddings for a spatial input domain
<span class="math notranslate nohighlight">\(\vec{x} \in[0,1]\)</span> consisting of 1000 equally spaced points, using <span class="math notranslate nohighlight">\(L = 3\)</span> frequency levels.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import required libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">neuralop.layers.embeddings</span><span class="w"> </span><span class="kn">import</span> <span class="n">SinusoidalEmbedding</span>

<span class="c1"># Set default font sizes for better readability</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                     <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>

<span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span>

<span class="c1"># Define a spatial domain and number of frequencies</span>
<span class="c1"># Create 1000 equally spaced points in [0, 1]</span>
<span class="c1">#  and normalize to [0, 2π] for proper sinusoidal embedding</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">x_normalized</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1"># Number of frequency levels for the embedding</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Check if the number of frequencies satisfies the Nyquist-Criterion</span>
<span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is satisfied for the given number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is violated for the given number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="c1"># Build embedding: [sin(x), cos(x), sin(2x), cos(2x), ...]</span>
<span class="c1"># Each frequency level contributes a sine and cosine pair</span>
<span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x_normalized</span><span class="p">))</span>
    <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x_normalized</span><span class="p">))</span>

<span class="c1"># Construct input by concatenating the original input and the embedding</span>
<span class="c1"># This preserves the original coordinates while adding spectral information</span>
<span class="n">input_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">g</span><span class="p">])</span>
<span class="n">input_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">input_arr</span><span class="p">)</span>

<span class="c1"># Plot the embedding components</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="o">.</span><span class="n">colors</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">freq_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">freq_idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
    <span class="n">sin_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">cos_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">2</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">input_tensor</span><span class="p">[</span><span class="n">sin_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Frequency </span><span class="si">{</span><span class="n">freq_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">input_tensor</span><span class="p">[</span><span class="n">cos_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Embedding value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sinusoidal Embedding Components (L = 3)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_sinusoidal_embeddings_001.png" srcset="../../_images/sphx_glr_plot_sinusoidal_embeddings_001.png" alt="Sinusoidal Embedding Components (L = 3)" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Nyquist-Shannon sampling theorem is satisfied for the given number of frequencies 3.
</pre></div>
</div>
<div style="margin-top: 4em;"></div></section>
</section>
<section id="encoding-constant-parameters">
<h2>Encoding Constant Parameters<a class="headerlink" href="#encoding-constant-parameters" title="Link to this heading"></a></h2>
<p>A particularly useful extension of sinusoidal embeddings is their ability to encode constant
parameters. Consider a setting where you have a scalar parameter <span class="math notranslate nohighlight">\(m\)</span> (such as a material
property, boundary condition, or physical constant) that you wish to feed into a model.
Instead of treating <span class="math notranslate nohighlight">\(m\)</span> as a fixed scalar input, we can represent it using periodic
functions, either by modulating the amplitude or the frequency of the sinusoidal components.</p>
<div style="margin-top: 2em;"></div><p><strong>1. Amplitude Modulation:</strong> To encode <span class="math notranslate nohighlight">\(m\)</span> by scaling the amplitudes of the sinusoidal
functions, we define the embedding as</p>
<div class="math notranslate nohighlight">
\[m \rightarrow m g(\vec{x}),\]</div>
<p>where each element of the embedding <span class="math notranslate nohighlight">\(g(\vec{x})\)</span> is multiplied by <span class="math notranslate nohighlight">\(m\)</span>.</p>
<div style="margin-top: 2em;"></div><p><strong>2. Frequency Modulation:</strong> Alternatively, to encode <span class="math notranslate nohighlight">\(m\)</span> by scaling the frequencies,
we define</p>
<div class="math notranslate nohighlight">
\[m \rightarrow g(m\vec{x})\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> multiplies the input argument of each sinusoidal component.</p>
<p>When encoding constant parameters through frequency modulation, care must be taken to ensure
that the Nyquist criterion is satisfied. In this case, where the modulation factor <span class="math notranslate nohighlight">\(m\)</span>
scales the frequencies, the Nyquist constraint becomes <span class="math notranslate nohighlight">\(L &lt; \frac{N}{2m}\)</span>.</p>
<div style="margin-top: 2em;"></div><p>Below, we demonstrate an example of encoding the parameter <span class="math notranslate nohighlight">\(m = 2.5\)</span> through both
amplitude and frequency modulation.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a spatial domain and number of frequencies</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">x_normalized</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Define parameter to encode</span>
<span class="n">m</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">m_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">m</span><span class="p">])</span>

<span class="c1"># Check if the number of frequencies and parameter satisfies the Nyquist-Criterion</span>
<span class="k">if</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is satisfied for the given parameter </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> and number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is violated for the given parameter </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> and number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="c1"># Build amplitude-modulated embedding: m * g(x)</span>
<span class="n">g_amplitude</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">g_amplitude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x_normalized</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_tensor</span><span class="p">)</span>
    <span class="n">g_amplitude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x_normalized</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_tensor</span><span class="p">)</span>

<span class="c1"># Build frequency-modulated embedding: g(m * x)</span>
<span class="n">g_frequency</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">g_frequency</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x_normalized</span> <span class="o">*</span> <span class="n">m_tensor</span><span class="p">))</span>
    <span class="n">g_frequency</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x_normalized</span> <span class="o">*</span> <span class="n">m_tensor</span><span class="p">))</span>

<span class="c1"># Convert to arrays for visualization</span>
<span class="n">input_amplitude</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">g_amplitude</span><span class="p">]))</span>
<span class="n">input_frequency</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">g_frequency</span><span class="p">]))</span>

<span class="c1"># Plot both embeddings</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="o">.</span><span class="n">colors</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">## Amplitude modulation</span>
<span class="k">for</span> <span class="n">freq_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">freq_idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
    <span class="n">sin_idx</span><span class="p">,</span> <span class="n">cos_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">input_amplitude</span><span class="p">[</span><span class="n">sin_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Channel </span><span class="si">{</span><span class="n">freq_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">input_amplitude</span><span class="p">[</span><span class="n">cos_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Amplitude Modulation&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Embedding value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1">## Frequency modulation</span>
<span class="k">for</span> <span class="n">freq_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">freq_idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
    <span class="n">sin_idx</span><span class="p">,</span> <span class="n">cos_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">input_frequency</span><span class="p">[</span><span class="n">sin_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Channel </span><span class="si">{</span><span class="n">freq_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">input_frequency</span><span class="p">[</span><span class="n">cos_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Frequency Modulation&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Embedding value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sinusoidal Embeddings with Parameter m = </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_sinusoidal_embeddings_002.png" srcset="../../_images/sphx_glr_plot_sinusoidal_embeddings_002.png" alt="Sinusoidal Embeddings with Parameter m = 2.5, Amplitude Modulation, Frequency Modulation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Nyquist-Shannon sampling theorem is satisfied for the given parameter 2.5 and number of frequencies 3.
</pre></div>
</div>
<div style="margin-top: 4em;"></div></section>
<section id="neural-operator-sinusoidalembedding-class">
<h2>Neural Operator SinusoidalEmbedding Class<a class="headerlink" href="#neural-operator-sinusoidalembedding-class" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">neuralop</span></code> library provides a unified sinusoidal positional embedding class,
<code class="docutils literal notranslate"><span class="pre">neuralop.layers.embeddings.SinusoidalEmbedding</span></code>, with the following embedding techniques:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">transformer</span></code> - Vaswani, A. et al (2017), “Attention Is All You Need”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nerf</span></code> - Mildenhall, B. et al (2020), “NeRF: Representing Scenes as Neural Radiance Fields for View Synthesis”.</p></li>
</ul>
<p>The <cite>SinusoidalEmbedding</cite> class expects inputs to be of shape</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">N,</span> <span class="pre">input_channels)</span></code> or <code class="docutils literal notranslate"><span class="pre">(N,</span> <span class="pre">input_channels)</span></code></p>
</div></blockquote>
<div style="margin-top: 2em;"></div><section id="embedding-variants">
<h3>Embedding Variants<a class="headerlink" href="#embedding-variants" title="Link to this heading"></a></h3>
<p>Let <span class="math notranslate nohighlight">\(\vec{x} \in \mathbb{R}^N\)</span> denote a 1D input domain consisting of
<span class="math notranslate nohighlight">\(N\)</span> discretized points. The embedding function
<span class="math notranslate nohighlight">\(g: \mathbb{R}^N \rightarrow \mathbb{R}^{N \times 2L}\)</span> maps each input value
<span class="math notranslate nohighlight">\(x_n\)</span> to a <span class="math notranslate nohighlight">\(2L\)</span>-dimensional vector composed of sine and cosine terms evaluated
at different frequencies. Each embedding type defines these frequencies differently,
leading to distinct representations.</p>
<div style="margin-top: 2em;"></div><p><strong>1. Transformer-style embedding:</strong> For <span class="math notranslate nohighlight">\(0 \leq k &lt; L\)</span>:</p>
<div class="math notranslate nohighlight">
\[g(\vec{x})_{:, 2 k}=\sin \left(\frac{\vec{x}}{\text { max_positions }^{k / L}}\right), \quad g(\vec{x})_{:, 2 k+1}=\cos \left(\frac{\vec{x}}{\text { max_positions }^{k / L}}\right) .\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\text{max_positions}\)</span> controls the maximum position for the embedding.</p>
<div style="margin-top: 2em;"></div><p><strong>2. NeRF-style embedding:</strong> For <span class="math notranslate nohighlight">\(0 \leq k &lt; L\)</span>:</p>
<div class="math notranslate nohighlight">
\[g(\vec{x})_{:, 2 k}=\sin \left(2^k \pi \vec{x}\right), \quad g(\vec{x})_{:, 2 k+1}=\cos \left(2^k \pi \vec{x}\right) .\]</div>
<p>In order to ensure that the Nyquist-Criterion is satisfied, for the Transformer-style
embedding, the embedding frequencies should satisfy: <span class="math notranslate nohighlight">\(f_{\max} &lt; f_{\text{Nyquist}}\)</span>.</p>
<p>For the NeRF-style embedding:</p>
<div class="math notranslate nohighlight">
\[2^{L-1} &lt; \frac{N}{2} \ \ \implies \ \  L &lt; 1 + \log_2\left(\frac{N}{2}\right).\]</div>
<div style="margin-top: 3em;"></div><p>Below, we include examples of using the <cite>SinusoidalEmbedding</cite> class with both the
transformer- and NeRF-style embeddings.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a spatial domain and the number of frequencies</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">x_normalized</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Check if the number of frequencies satisfies the Nyquist-Criterion</span>
<span class="k">if</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is satisfied for the given number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is violated for the given number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="c1"># Define the transformer embedding</span>
<span class="c1"># max_positions controls the frequency scaling in transformer-style embeddings</span>
<span class="n">max_positions</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">transformer_embedder</span> <span class="o">=</span> <span class="n">SinusoidalEmbedding</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                           <span class="n">num_frequencies</span><span class="o">=</span><span class="n">L</span><span class="p">,</span>
                                           <span class="n">embedding_type</span><span class="o">=</span><span class="s1">&#39;transformer&#39;</span><span class="p">,</span>
                                           <span class="n">max_positions</span><span class="o">=</span><span class="n">max_positions</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Apply transformer-style embedding</span>
<span class="n">transformer_embedding</span> <span class="o">=</span> <span class="n">transformer_embedder</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Define the NeRF embedding</span>
<span class="n">nerf_embedder</span> <span class="o">=</span> <span class="n">SinusoidalEmbedding</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">num_frequencies</span><span class="o">=</span><span class="n">L</span><span class="p">,</span>
                                    <span class="n">embedding_type</span><span class="o">=</span><span class="s1">&#39;nerf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Apply NeRF-style embedding</span>
<span class="n">nerf_embedding</span> <span class="o">=</span> <span class="n">nerf_embedder</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot both embeddings</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="o">.</span><span class="n">colors</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">## Transformer embedding</span>
<span class="k">for</span> <span class="n">freq_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">freq_idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
    <span class="n">sin_idx</span><span class="p">,</span> <span class="n">cos_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">transformer_embedding</span><span class="p">[</span><span class="n">sin_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Channel </span><span class="si">{</span><span class="n">freq_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">transformer_embedding</span><span class="p">[</span><span class="n">cos_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Transformer embedding&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Embedding value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1">## NeRF embedding</span>
<span class="k">for</span> <span class="n">freq_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">freq_idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
    <span class="n">sin_idx</span><span class="p">,</span> <span class="n">cos_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nerf_embedding</span><span class="p">[</span><span class="n">sin_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Channel </span><span class="si">{</span><span class="n">freq_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nerf_embedding</span><span class="p">[</span><span class="n">cos_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;NeRF embedding&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Embedding value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sinusoidal Embeddings using transformer and NeRF embedding types&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_sinusoidal_embeddings_003.png" srcset="../../_images/sphx_glr_plot_sinusoidal_embeddings_003.png" alt="Sinusoidal Embeddings using transformer and NeRF embedding types, Transformer embedding, NeRF embedding" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Nyquist-Shannon sampling theorem is satisfied for the given number of frequencies 3.
</pre></div>
</div>
<div style="margin-top: 2em;"></div></section>
<section id="encoding-constant-parameters-with-neuralop-class">
<h3>Encoding Constant Parameters with NeuralOp Class<a class="headerlink" href="#encoding-constant-parameters-with-neuralop-class" title="Link to this heading"></a></h3>
<p>Similar to the earlier illustrative examples, we can also encode
a scalar parameter <span class="math notranslate nohighlight">\(m\)</span> before passing it to a model. Once again, care must be taken to
ensure that the Nyquist criterion is satisfied.</p>
<p>In the Transformer-style embedding, to avoid aliasing, the embedding frequencies should still
satisfy</p>
<div class="math notranslate nohighlight">
\[f_{\max} &lt; f_{\text{Nyquist}}.\]</div>
<p>For the NeRF-style embedding, the modified constraint becomes:</p>
<div class="math notranslate nohighlight">
\[2^{L-1}m &lt; \frac{N}{2} \implies L &lt; 1 + \log_2\left(\frac{N}{2m}\right).\]</div>
<div style="margin-top: 2em;"></div><p>Below, we demonstrate an example of encoding the parameter <span class="math notranslate nohighlight">\(m = 2.5\)</span> through frequency
modulation of the NeRF-style embedding.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a spatial domain and the number of frequencies</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">x_normalized</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Define the parameter to encode</span>
<span class="n">m</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">m_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">m</span><span class="p">])</span>

<span class="c1"># Check if the number of frequencies and parameter satisfies the Nyquist-Criterion</span>
<span class="k">if</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is satisfied for the given parameter </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> and number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is violated for the given parameter </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> and number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="c1"># Define the NeRF embedding</span>
<span class="n">nerf_embedder</span> <span class="o">=</span> <span class="n">SinusoidalEmbedding</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">num_frequencies</span><span class="o">=</span><span class="n">L</span><span class="p">,</span>
                                    <span class="n">embedding_type</span><span class="o">=</span><span class="s1">&#39;nerf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Apply frequency modulation: multiply input by parameter before embedding</span>
<span class="c1"># This scales all frequencies by the parameter m</span>
<span class="n">nerf_embedding</span> <span class="o">=</span> <span class="n">nerf_embedder</span><span class="p">(</span><span class="n">x_normalized</span> <span class="o">*</span> <span class="n">m_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot the embedding</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="o">.</span><span class="n">colors</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">freq_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">freq_idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
    <span class="n">sin_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span>
    <span class="n">cos_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nerf_embedding</span><span class="p">[</span><span class="n">sin_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">freq_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nerf_embedding</span><span class="p">[</span><span class="n">cos_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Embedding&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;NeRF-style embedding with modulated frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_sinusoidal_embeddings_004.png" srcset="../../_images/sphx_glr_plot_sinusoidal_embeddings_004.png" alt="NeRF-style embedding with modulated frequency" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Nyquist-Shannon sampling theorem is satisfied for the given parameter 2.5 and number of frequencies 3.
</pre></div>
</div>
<p>Similarly, we can encode the parameter <span class="math notranslate nohighlight">\(m = 2.5\)</span> through amplitude modulation, where we show
an example using the NeRF-style embedding below.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a spatial domain and the number of frequencies</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">x_normalized</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Define the parameter to encode</span>
<span class="n">m</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">m_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">m</span><span class="p">])</span>

<span class="c1"># Check if the number of frequencies and parameter satisfies the Nyquist-Criterion</span>
<span class="k">if</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is satisfied for the given number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is violated for the given number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="c1"># Define the embedding</span>
<span class="n">nerf_embedder</span> <span class="o">=</span> <span class="n">SinusoidalEmbedding</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">num_frequencies</span><span class="o">=</span><span class="n">L</span><span class="p">,</span>
                                    <span class="n">embedding_type</span><span class="o">=</span><span class="s1">&#39;nerf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Apply amplitude modulation: multiply embedding by parameter after computation</span>
<span class="c1"># This scales all embedding components by the parameter m</span>
<span class="n">nerf_embedding</span> <span class="o">=</span> <span class="n">nerf_embedder</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_tensor</span>

<span class="c1"># Plot the embedding</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="o">.</span><span class="n">colors</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">freq_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">freq_idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
    <span class="n">sin_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span>
    <span class="n">cos_idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq_idx</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nerf_embedding</span><span class="p">[</span><span class="n">sin_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">freq_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nerf_embedding</span><span class="p">[</span><span class="n">cos_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Embedding&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;NeRF-style embedding with amplitude modulation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_sinusoidal_embeddings_005.png" srcset="../../_images/sphx_glr_plot_sinusoidal_embeddings_005.png" alt="NeRF-style embedding with amplitude modulation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Nyquist-Shannon sampling theorem is satisfied for the given number of frequencies 3.
</pre></div>
</div>
<div style="margin-top: 4em;"></div></section>
</section>
<section id="application-to-fourier-neural-operators-fnos">
<h2>Application to Fourier Neural Operators (FNOs)<a class="headerlink" href="#application-to-fourier-neural-operators-fnos" title="Link to this heading"></a></h2>
<p>Fourier Neural Operators (FNOs) learn mappings between functions by operating in the frequency domain.
They use the Fourier transform to express data as combinations of sine and cosine components,
enabling them to capture complex, multi-scale interactions across frequencies.
Given that sinusoidal embeddings also lift low-dimensional data into a richer spectral
representation, they complement FNOs naturally.
This synergy makes sinusoidal embeddings particularly effective for neural operator architectures.</p>
<p>In the general setting for neural operators, we strongly recommend choosing the number of frequencies
<span class="math notranslate nohighlight">\(L\)</span> such that the Nyquist-Criterion is not violated. This can be done by following the guidelines
we provided earlier for selecting <span class="math notranslate nohighlight">\(L\)</span> in both transformer-style and NeRF-style embeddings.</p>
<p>When dealing with FNOs with a specified number of Fourier modes, <span class="math notranslate nohighlight">\(\text{n_modes}\)</span>, the
highest embedded frequency should ideally also remain below <span class="math notranslate nohighlight">\(\text{n_modes}\)</span>,
as higher frequencies will be zeroed out and not acted upon by the spectral convolution operation.</p>
<p>For the NeRF-style embedding, this condition leads to an explicit upper bound on <span class="math notranslate nohighlight">\(L\)</span>:</p>
<div class="math notranslate nohighlight">
\[2^{L-1} &lt; \text{n_modes} \ \ \implies \ \  L &lt; 1 + \log_2\left(\text{n_modes}\right).\]</div>
<div style="margin-top: 4em;"></div></section>
<section id="setup-in-higher-dimensions">
<h2>Setup in Higher Dimensions<a class="headerlink" href="#setup-in-higher-dimensions" title="Link to this heading"></a></h2>
<p>Let <span class="math notranslate nohighlight">\(X \in \mathbb{R}^{d \times N}\)</span> denote a <span class="math notranslate nohighlight">\(d\)</span>-dimensional input domain consisting of
<span class="math notranslate nohighlight">\(N\)</span> discretised points, where each row <span class="math notranslate nohighlight">\(\vec{x}_{i} \in \mathbb{R}^N\)</span> corresponds to
the sampled coordinates along the <span class="math notranslate nohighlight">\(i\)</span>-th spatial or temporal dimension. Thus, each column
of <span class="math notranslate nohighlight">\(X\)</span> represents a single point <span class="math notranslate nohighlight">\(\vec{x}_{:,j} \in \mathbb{R}^d\)</span> in the
<span class="math notranslate nohighlight">\(d\)</span>-dimensional domain.</p>
<p>Building on the 1D embedding function <span class="math notranslate nohighlight">\(g\)</span> introduced earlier, we define the
multi-dimensional embedding</p>
<div class="math notranslate nohighlight">
\[h: \mathbb{R}^{d \times N} \ \  \rightarrow \ \ \mathbb{R}^{N \times 2 L d}, \quad h(X)=\operatorname{concat}\left(g\left(\vec{x}_1\right), g\left(\vec{x}_2\right), \ldots, g\left(\vec{x}_d\right)\right),\]</div>
<p>where each <span class="math notranslate nohighlight">\(\vec{x}_i\)</span> denotes the sampled domain along the <span class="math notranslate nohighlight">\(i\)</span>-th input dimension.</p>
<p>The multi-dimensional embedding function <span class="math notranslate nohighlight">\(h\)</span> applies the 1D embedding function <span class="math notranslate nohighlight">\(g\)</span>
independently to each coordinate dimension and concatenates the resulting embeddings
along the feature axis. This approach allows the model to capture
frequency patterns along each dimension separately while maintaining the overall structure.</p>
<div style="margin-top: 2em;"></div><p>Below, we include an example of using the <cite>SinusoidalEmbedding</cite> class to construct NeRF-style
embeddings for a 3D input.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a 1D spatial domain and construct 3D input by repeating the normalized 1D domain</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">x_1d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="c1"># Normalize to [0, 2π] and add channel dimension</span>
<span class="n">x_normalized_1d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">x_1d</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">x_1d</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Repeat for 3D input: shape (N, 3)</span>
<span class="n">x_normalized</span> <span class="o">=</span> <span class="n">x_normalized_1d</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>

<span class="c1"># Define the number of frequencies</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Check if the number of frequencies satisfies the Nyquist-Criterion</span>
<span class="c1"># For multi-dimensional inputs, the constraint applies to each dimension independently</span>
<span class="k">if</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is satisfied for the given number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nyquist-Shannon sampling theorem is violated for the given number of frequencies </span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="c1"># Define the transformer embedding</span>
<span class="n">max_positions</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">transformer_embedder</span> <span class="o">=</span> <span class="n">SinusoidalEmbedding</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                           <span class="n">num_frequencies</span><span class="o">=</span><span class="n">L</span><span class="p">,</span>
                                           <span class="n">embedding_type</span><span class="o">=</span><span class="s1">&#39;transformer&#39;</span><span class="p">,</span>
                                           <span class="n">max_positions</span><span class="o">=</span><span class="n">max_positions</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Apply transformer-style embedding</span>
<span class="n">transformer_embedding</span> <span class="o">=</span> <span class="n">transformer_embedder</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Define the NeRF embedding</span>
<span class="n">nerf_embedder</span> <span class="o">=</span> <span class="n">SinusoidalEmbedding</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
                                    <span class="n">num_frequencies</span><span class="o">=</span><span class="n">L</span><span class="p">,</span>
                                    <span class="n">embedding_type</span><span class="o">=</span><span class="s1">&#39;nerf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Apply NeRF-style embedding</span>
<span class="n">nerf_embedding</span> <span class="o">=</span> <span class="n">nerf_embedder</span><span class="p">(</span><span class="n">x_normalized</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Nyquist-Shannon sampling theorem is satisfied for the given number of frequencies 3.
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.767 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-layers-plot-sinusoidal-embeddings-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/b1816e343c1a9a8d9033515c4c1295c4/plot_sinusoidal_embeddings.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_sinusoidal_embeddings.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/9ed8e0f2fb5ea1a965e33e31a6446d97/plot_sinusoidal_embeddings.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_sinusoidal_embeddings.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/ceca232e160d9563fc2c1c528daaae84/plot_sinusoidal_embeddings.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">plot_sinusoidal_embeddings.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


      </div>

      
        <nav class="pagination" role="navigation" aria-label="pagination">
    
    <a class="button pagination-previous" href="plot_fourier_diff.html" title="previous page" accesskey="p">
        <span class="icon">
            <i class="fa fa-arrow-circle-left"></i>
        </span>
        <span>Fourier Differentiation</span>
    </a>
    
    
    <a class="button pagination-next" href="plot_fourier_continuation.html" title="next page" accesskey="n">
        <span>Fourier Continuation </span>
        <span class="icon">
            <i class="fa fa-arrow-circle-right"></i>
        </span>
    </a>
    
</nav>

      

        <footer class="footer">
    <div class="content has-text-centered">
        <div class="block">
          &copy; Copyright 2025, Jean Kossaifi, David Pitt, Nikola Kovachki, Zongyi Li and Anima Anandkumar.<br/>
        </div>
    </div>
  </footer>

    </div>

  </div>  

	
    
    <div class="column is-hidden-touch is-2-desktop is-one-fifth-widescreen" id="localtoc-column">

    <aside class="sticky-nav localtoc"> 
        <p class="menu-label"> 
            <span class="icon-text">
                <span class="icon"><i class="fas fa-duotone fa-list"></i></span>
                <span> On this page </span>
            </span>
        </p>

        <div class="menu menu-list localtoc-list">
        <ul>
<li><a class="reference internal" href="#">Sinusoidal Embeddings</a><ul>
<li><a class="reference internal" href="#setup-in-1d">Setup in 1D</a><ul>
<li><a class="reference internal" href="#domain-normalization">Domain Normalization</a></li>
<li><a class="reference internal" href="#choosing-l-to-satisfy-the-nyquist-criterion">Choosing <span class="math notranslate nohighlight">\(L\)</span> to Satisfy the Nyquist-Criterion</a></li>
<li><a class="reference internal" href="#visualizing-the-sinusoidal-embeddings">Visualizing the Sinusoidal Embeddings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#encoding-constant-parameters">Encoding Constant Parameters</a></li>
<li><a class="reference internal" href="#neural-operator-sinusoidalembedding-class">Neural Operator SinusoidalEmbedding Class</a><ul>
<li><a class="reference internal" href="#embedding-variants">Embedding Variants</a></li>
<li><a class="reference internal" href="#encoding-constant-parameters-with-neuralop-class">Encoding Constant Parameters with NeuralOp Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-to-fourier-neural-operators-fnos">Application to Fourier Neural Operators (FNOs)</a></li>
<li><a class="reference internal" href="#setup-in-higher-dimensions">Setup in Higher Dimensions</a></li>
</ul>
</li>
</ul>

        </div>
    </aside>
    </div>

  

  </div>  
  </div> 

  
  <script>
    function toggle_sidebar() {
        var element = document.getElementById("sidebar");
        var container = document.getElementById("column-container");
        var localtoccolumn = document.getElementById("localtoc-column");
        element.classList.toggle("hide-tablet");
        element.classList.toggle("is-hidden-mobile");
        container.classList.toggle("sidemenu-hidden");
        localtoccolumn.classList.toggle("is-one-fifth-widescreen");
        localtoccolumn.classList.toggle("is-2-desktop");
        localtoccolumn.classList.toggle("is-3-desktop");
    }
  </script> 



  </body>
</html>